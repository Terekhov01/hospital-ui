<div class = "scheduleDiv mat-elevation-z4">
    <div class = "filtersDiv">
        <app-doctor-selector (pickedDoctors) = "doctorsPickedChanged($event)" [maxPickAmount] = "5" id = "doctorSelector"></app-doctor-selector>
        <app-material-date-range-picker (pickedDateRange) = "calendarDateRangeChanged($event)" [rangeMaxLengthInDays] = "31" id = "dateRangePicker"></app-material-date-range-picker>
        <button mat-raised-button color = "primary" (click) = "showSchedule()" id = "showScheduleButton">Показать</button>
    </div>

    <div *ngFor = "let doctorSchedule of dataSource.getSchedulesSubject() | async; let doctorCounter = index">    

        <hr>

        <div class = "doctorNameDiv">
            {{ dataSource.getDoctorsInfoSubject().value[doctorCounter].lastName }}
            {{ dataSource.getDoctorsInfoSubject().value[doctorCounter].firstName }}
            {{ dataSource.getDoctorsInfoSubject().value[doctorCounter].middleName }}
        </div>
        
        <div *ngIf = "dataSource.getDoctorsInfoSubject().value[doctorCounter].specializationNames.length === 0; else hasSpecializations;" class = "specializationNamesDiv">
            Специализации: Не указано
        </div>

        <ng-template #hasSpecializations>
            <div *ngIf = "dataSource.getDoctorsInfoSubject().value[doctorCounter].specializationNames.join(', ').length <= 40; else hasLongSpecializations" class = "specializationNamesDiv">
                Специализации: {{ dataSource.getDoctorsInfoSubject().value[doctorCounter].specializationNames.join(', ') }}
            </div>
        </ng-template>
        
        <ng-template #hasLongSpecializations>
            <div style = "text-decoration: underline;" matTooltipClass = "tool-tip" 
                            [matTooltip] = "dataSource.getDoctorsInfoSubject().value[doctorCounter].specializationNames.join(', ')" 
                            [aria-label] = "dataSource.getDoctorsInfoSubject().value[doctorCounter].specializationNames.join(', ')" class = "specializationNamesDiv">
                Наведите, чтобы посмотреть специализации
            </div>
        </ng-template>


        <div class="scheduleTableDiv mat-elevation-z4">        

            <table mat-table [dataSource] = "doctorSchedule" class = "scheduleTable">

                <!-- Do not forget to change index in following line if you want to change columns amount before dynamic columns block
                    and to set style with absolute width/position so angular can draw spacer and items correctly -->
                <ng-container *ngFor = "let header of columnHeaderDates; let columnCounter = index" matColumnDef = {{displayedColumns[columnCounter]}}>

                    <th mat-header-cell *matHeaderCellDef class = "dynamicAmountColumnHeader"> 
                        <div>{{columnHeaderDayOfWeekNames[columnCounter]}}</div> 
                        <div>{{header}}</div>
                    </th>

                    <td mat-cell *matCellDef = "let row; let rowCounter = index;" class = "dynamicAmountColumnContents">

                        <ng-template *ngIf = "row[columnCounter] != null;
                                        then printInterval;
                                        else printEmpty">
                        </ng-template>

                        <ng-template #printInterval>
                            <div>
                                {{ row[columnCounter].toString() }}
                            </div>
                        </ng-template>

                        <ng-template #printEmpty></ng-template>
                    </td> 

                </ng-container>
            
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
        </div>
    </div>
</div>