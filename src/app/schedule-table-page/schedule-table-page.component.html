<div class = "scheduleDiv mat-elevation-z4">

    <div class = "titleText">
        <h1>Расписания докторов</h1>
    </div>

    <div class = "filtersDiv">
        <app-doctor-selector (pickedDoctors) = "doctorsPickedChanged($event)" [maxPickAmount] = "5" id = "doctorSelector"></app-doctor-selector>
        <app-material-date-range-picker (pickedDateRange) = "calendarDateRangeChanged($event)" [rangeMaxLengthInDays] = "31" id = "dateRangePicker"></app-material-date-range-picker>
        <button class = "btn btn-primary" (click) = "showSchedule()" id = "showScheduleButton">Показать</button>
    </div>

    <div *ngFor = "let doctorSchedule of dataSource.getSchedulesSubject() | async; let doctorCounter = index">    

        <hr>

        <div class = "preTableDiv">
            <div class = "doctorNameDiv">
                Врач: 
                {{ doctorSchedule.doctorInfo.lastName }}
                {{ doctorSchedule.doctorInfo.firstName }}
                {{ doctorSchedule.doctorInfo.middleName }}
            </div>
            
            <div *ngIf = "doctorSchedule.doctorInfo.specializationNames.length === 0; else hasSpecializations;" class = "specializationNamesDiv">
                Специализации: Не указано
            </div>

            <ng-template #hasSpecializations>
                <div *ngIf = "doctorSchedule.doctorInfo.specializationNames.join(', ').length <= 40; else hasLongSpecializations" class = "specializationNamesDiv">
                    Специализации (-я): {{ doctorSchedule.doctorInfo.specializationNames.join(', ') }}
                </div>
            </ng-template>
            
            <ng-template #hasLongSpecializations>
                <div style = "text-decoration: underline;" matTooltipClass = "tool-tip" 
                                [matTooltip] = "doctorSchedule.doctorInfo.specializationNames.join(', ')" 
                                [aria-label] = "doctorSchedule.doctorInfo.specializationNames.join(', ')" class = "specializationNamesDiv">
                    Наведите, чтобы посмотреть специализации
                </div>
            </ng-template>
        </div>


        <div class="scheduleTableDiv">        

            <div *ngFor = "let currentWeek of doctorSchedule.weeklyInformation">

                <table mat-table [dataSource] = "doctorSchedule.weeklyInformation" class = "scheduleTable mat-elevation-z2" style = "margin: 3px">
                    
                    <ng-container *ngFor = "let currentDay of currentWeek.dailyInformation; let columnCounter = index" matColumnDef = {{displayedColumns[columnCounter]}}>

                        <th mat-header-cell *matHeaderCellDef class = "dynamicAmountColumnHeader"> 
                            <div>{{this.getDayName(currentDay.date, this.userLocale)}}</div> 
                            <div>{{this.datePipe.transform(currentDay.date, 'dd.MM.yyyy')}}</div>
                        </th>
    
                        <td mat-cell *matCellDef = "let row; let rowCounter = index;" class = "dynamicAmountColumnContents"
                        [ngClass] = "(currentDay.date >= filterSettings.getStartDate() && currentDay.date <= filterSettings.getEndDate()) ? '' : 'emptyCell'" >

                            <ng-container *ngIf = "currentDay.timeIntervals[rowCounter] != null;
                                            then printInterval;
                                            else printEmpty">
                            </ng-container>
    
                            <ng-template #printInterval class = "cellContents">
                                <div>
                                    {{ currentDay.timeIntervals[rowCounter].toString() }}
                                </div>
                            </ng-template>
    
                            <!-- Empty cell, but doctor does work this day -->
                            <ng-template #printEmpty class = "cellContents">
                                <ng-container *ngIf = "!(currentDay.isWeekend()); else printWeekend">
                                </ng-container>
                            </ng-template>

                            <!-- Doctor doesn't work this day -->
                            <ng-template #printWeekend class = "cellContents">
                                <ng-container *ngIf = "currentDay.date >= filterSettings.getStartDate() && currentDay.date <= filterSettings.getEndDate(); else printUndefined">
                                    <div *ngIf = "rowCounter == 0" [ngClass] = "(columnCounter == displayedColumns.length - 1) ? 'lastColumn' : '' ">Выходной</div>
                                </ng-container>
                            </ng-template>

                            <!-- No information present for this day -->
                            <ng-template #printUndefined>
                            </ng-template>
                        </td> 
    
                    </ng-container>
                
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                </table>

                <br>

            </div>

            <!-- Do not forget to change index in following line if you want to change columns amount before dynamic columns block
                and to set style with absolute width/position so angular can draw spacer and items correctly -->
                
            <!--<table mat-table [dataSource] = "doctorSchedule" class = "scheduleTable">
                <ng-container *ngFor = "let header of columnHeaderDates; let columnCounter = index" matColumnDef = {{displayedColumns[columnCounter]}}>

                    <th mat-header-cell *matHeaderCellDef class = "dynamicAmountColumnHeader"> 
                        <div>{{columnHeaderDayOfWeekNames[columnCounter]}}</div> 
                        <div>{{header}}</div>
                    </th>

                    <td mat-cell *matCellDef = "let row; let rowCounter = index;" class = "dynamicAmountColumnContents">

                        <ng-template *ngIf = "row[columnCounter] != null;
                                        then printInterval;
                                        else printEmpty">
                        </ng-template>

                        <ng-template #printInterval class = "cellContents">
                            <div>
                                {{ row[columnCounter].toString() }}
                            </div>
                        </ng-template>

                        <ng-template #printEmpty class = "cellContents"></ng-template>
                    </td> 

                </ng-container>
            
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>-->
        </div>
    </div>
</div>