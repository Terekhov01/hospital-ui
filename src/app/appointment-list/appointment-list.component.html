<br>

<div class="card text-center">
  <div class="card-body">
    <h1>Список прошедших приемов</h1>
  </div>
</div>

<!--<ng-template #fileViewer let-modal>-->
<!--  <div class="modal-header text-center bg-primary">-->
<!--    <h2 class="modal-title text-center">Информация о записи на прием</h2>-->
<!--    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>-->
<!--  </div>-->
<!--  <div class="modal-body">-->
<!--    <div *ngIf = "!filesLoaded">-->
<!--      <mat-progress-bar mode="indeterminate"></mat-progress-bar>-->
<!--    </div>-->

<!--    <div *ngIf = "filesLoaded">-->

<!--      <div class="card">-->
<!--        <div class="card-body">-->

<!--          <div>-->
<!--            <br>-->
<!--          </div>-->

<!--          <div class = "mat-elevation-z4 fileList">-->
<!--  <span *ngFor = "let fileResource of fileResources" class = "filePresentationRow">-->
<!--    <p class = "fileName">{{fileResource.fileName}}</p>-->
<!--    <span *ngIf = "fileResource.mimetype !== ''" style = "display: inline-block; margin-right: 10px">-->
<!--      <button mat-mini-fab color = "primary" aria-label = "Preview button" (click) = "displayFile(fileResource)">-->
<!--        <mat-icon>preview</mat-icon>-->
<!--      </button>-->
<!--    </span>-->
<!--    <button mat-mini-fab color = "primary" aria-label = "Preview button" (click) = "downloadFile(fileResource)">-->
<!--      <mat-icon>download</mat-icon>-->
<!--    </button>-->
<!--  </span>-->

<!--          </div>-->

<!--          <div>-->
<!--            <br>-->
<!--          </div>-->

<!--          <div *ngIf = "displayedFile !== null" class = "documentBlock">-->

<!--            <h1> {{ displayedFile.fileName }} </h1>-->
<!--            <h3> Дата загрузки: {{ this.datePipe.transform(displayedFile.creationDate, 'dd.MM.yyyy hh:mm:ss') }} </h3>-->
<!--            &lt;!&ndash; Present each file differently based on file type (extension) &ndash;&gt;-->

<!--            <div [ngSwitch] = "displayedFile.mimetype">-->

<!--              <div *ngSwitchCase = "'application/pdf'">-->
<!--                <ngx-extended-pdf-viewer-->
<!--                  [src]="displayedFile.fileUrl"-->
<!--                  [useBrowserLocale]="true"-->
<!--                  [textLayer]="true"-->
<!--                  [showHandToolButton]="true"-->
<!--                  [showPresentationModeButton]="true"-->
<!--                  [showDownloadButton]="false"-->
<!--                >-->
<!--                </ngx-extended-pdf-viewer>-->
<!--              </div>-->

<!--              <div *ngSwitchCase = "displayedFile.mimetype === 'application/msword'-->
<!--                      || displayedFile.mimetype === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ? displayedFile.mimetype : ''">-->

<!--                <div id = "docxContainer" style = "border-bottom: solid 10px #808080;"></div>-->
<!--              </div>-->

<!--              <div *ngSwitchCase = "'text/plain'">-->
<!--                <div class="form-group blue-border">-->
<!--                  <textarea class="form-control" id = "plainTextContainer" rows="3"></textarea>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div *ngSwitchDefault>-->
<!--                Предпросмотр документа {{ displayedFile.fileName }} недоступен-->
<!--              </div>-->
<!--            </div>-->

<!--          </div>-->

<!--          <div>-->
<!--            <br>-->
<!--          </div>-->

<!--          <button mat-raised-button color="primary" (click)="downloadAllFiles()" id = "downloadAllButton"> Скачать все </button>-->

<!--          <div>-->
<!--            <br>-->
<!--          </div>-->

<!--          <button (click)="backToDetails(this.fileId)" mat-raised-button color="primary"> Назад </button>-->

<!--        </div>-->
<!--      </div>-->

<!--    </div>-->

<!--  </div>-->
<!--  <div class="modal-footer">-->
<!--    <button type="button" class="btn btn-light" (click)="modal.close('Close click')">Закрыть</button>-->
<!--  </div>-->
<!--</ng-template>-->

<ng-template #loading let-modal>
  <div *ngIf = "!activateLoadingModal">

    <div class="modal-header bg-primary">
      <h2 class="modal-title">Пожалуйста, подождите</h2>
<!--      <button type="button" class="btn-close" aria-label="Close button" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')"></button>-->
    </div>

    <div class="modal-body">
      <div>
        <div class="card">
          <div class="card-body">
            <strong>Идет загрузка...</strong>
            <br>
            <br>
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          </div>
        </div>
        <br>
        <button type="button" class="btn btn-outline-primary" (click)="modal.dismiss('cancel click')">Готово</button>
      </div>
    </div>

<!--    <div class="modal-footer">-->
<!--      <button type="button" class="btn btn-outline-success" (click)="modal.dismiss('cancel click')">Готово</button>-->
<!--    </div>-->

  </div>
</ng-template>

<ng-template #content let-modal>
  <div class="modal-header bg-primary">
    <h1 class="modal-title" id="modal-title">Детали приема</h1>
    <button type="button" class="btn-close" aria-label="Close button" aria-describedby="modal-title" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">

    <div>
      <div class="card">
        <div class="card-body">
          <div>
            <label> <b> Фамилия доктора: </b>  </label> {{appointment.appointmentRegistration.doctor.user.lastName}} {{appointment.appointmentRegistration.doctor.user.firstName}} {{appointment.appointmentRegistration.doctor.user.patronymic}}
          </div>
          <div>
            <label> <b> Фамилия пациента: </b>  </label> {{appointment.appointmentRegistration.patient.user.lastName}} {{appointment.appointmentRegistration.patient.user.firstName}} {{appointment.appointmentRegistration.patient.user.patronymic}}
          </div>
          <div>
            <label> <b> Дата и время начала приема: </b>  </label> {{datePipe.transform(appointment.appointmentRegistration.start, "yyyy/MM/dd HH:mm")}}
          </div>
          <div>
            <label> <b> Образование доктора: </b>  </label> {{appointment.appointmentRegistration.doctor.education}}
          </div>
          <div>
            <label> <b> Кабинет: </b>  </label> {{appointment.appointmentRegistration.room}}
          </div>
        </div>
      </div>
      <div>
        <br>
      </div>
      <div class="card">
        <div class="card-body">
          <div>
            <div class="card">
              <div class="card-header" style="vertical-align: bottom">
                <h4> <b> Описание: </b>  </h4>
              </div>
              <div class="card-body">
                <span style="white-space: pre">{{appointment.description}}</span>
              </div>
            </div>
          </div>
          <br>
          <div>
            <div class="card">
              <div class="card-header">
                <h4> <b> Заключение врача: </b>  </h4>
              </div>
              <div class="card-body">
                <span style="white-space: pre">{{appointment.docStatement}}</span>
              </div>
            </div>
          </div>
          <br>
          <div>
            <div class="card">
              <div class="card-header">
                <h4> <b> Рецепт: </b>  </h4>
              </div>
              <div class="card-body">
                <span style="white-space: pre">{{appointment.recipe}}</span>
              </div>
            </div>
          </div>
          <br>
          <div>
            <div class="card">
              <div class="card-header">
                <h4> <b> План реабилитации: </b>  </h4>
              </div>
              <div class="card-body">
                <span style="white-space: pre">{{appointment.rehabPlan}}</span>
              </div>
            </div>
          </div>
          <br>
          <div>
            <div class="card">
              <div class="card-header">
                <h4> <b> План лечения: </b>  </h4>
              </div>
              <div class="card-body">
                <p><span style="white-space: pre">{{appointment.treatPlan}}</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <br>
      </div>
      <div class="card">
        <div class="card-body">
          <div class="btn-toolbar" role="toolbar">
<!--            <div class="btn-group mr-2" role="group" aria-label="First group">-->
<!--              <button (click)="goToFileViewer(fileViewer, appointment.id)" mat-raised-button color="primary" class="MyButton"> Просмотреть файлы </button>-->
<!--            </div>-->
            <div class="btn-group mr-2" role="group" aria-label="First group">
              <button (click)="goToFileViewer1(appointment.id)" mat-raised-button color="primary" class="MyButton"> Просмотреть файлы </button>
            </div>
            <div class="btn-group mr-2" role="group" aria-label="First group">
              <button (click)="printRecipe(loading, appointment.id)" mat-raised-button color="primary" class="MyButton"> Напечатать рецепт </button>
            </div>
          </div>
        </div>
      </div>
      <div>
        <br>
      </div>
    </div>


  </div>
<!--  <div class="modal-footer">-->
<!--    <button type="button" class="btn btn-outline-secondary" (click)="modal.dismiss('cancel click')">Закрыть</button>-->
<!--&lt;!&ndash;    <button type="button" ngbAutofocus class="btn btn-danger" (click)="deleteAppointmentRegistration(arToDelete)">OK</button>&ndash;&gt;-->
<!--  </div>-->
</ng-template>

<br>

<div *ngIf = "!isLoaded">
<mat-progress-bar mode="indeterminate"></mat-progress-bar>
</div>

<div *ngIf="isLoaded">

  <div *ngIf="appointments !== null && !isEmpty">

    <div *ngIf="isTableLoaded">


        <div class="mb-3 row">
          <label for="table-complete-search" class="col-xs-3 col-sm-auto col-form-label" style="text-align: center"> <h2> Поиск: </h2> </label>
          <div class="col col-form-label">
            <input id="table-complete-search" type="text" class="form-control" name="searchTerm" [(ngModel)]="keyWord" matTooltip="Введите ключевые слова для поиска" [matTooltipPosition]="'above'">
          </div>
          <span class="col col-form-label"> <button (click)="search()" mat-raised-button class="MyButton"> Найти
          </button> <button (click)="reset()" mat-raised-button class="MyButton" style="margin-left: 30px" matTooltip="Сбросить критерии поиска" [matTooltipPosition]="'above'"> Сброс
          </button> </span>
        </div>


      <table class="table table-bordered">
      <thead class="table-secondary">
      <tr>
        <th> Описание</th>
        <th scope="col" sortable="lastName" (sort)="onSort1($any($event))"> <a>Пациент <button style="background-color: transparent; border:0px"> <i class="pi pi-sort"></i></button> </a></th>
        <th scope="col" sortable="start" (sort)="onSort($any($event))"> <a>Дата и время <button style="background-color: transparent; border:0px"> <i class="pi pi-sort"></i></button> </a></th>
        <th> Действия</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let appointment of appointments">
        <td>
          <div *ngIf="appointment.description.length <= 50">
            {{appointment.description}}
          </div>
          <div *ngIf="appointment.description.length > 50">
            {{appointment.description.substr(0,47)}}&hellip;
          </div>
        </td>
        <td> {{appointment.appointmentRegistration.patient.user.lastName}} {{appointment.appointmentRegistration.patient.user.firstName.substr(0,1)}}. {{appointment.appointmentRegistration.patient.user.patronymic.substr(0,1)}}. </td>
        <td> {{datePipe.transform(appointment.appointmentRegistration.start, "yyyy/MM/dd HH:mm")}} </td>
        <td>
          <button (click)="appointmentDetails(content, appointment.id, appointment)" mat-raised-button class="MyButton"
                  style="margin-left: 10px"> Детали
          </button>
          <button (click)="MedCard(appointment.appointmentRegistration.patient.user.id)" mat-raised-button class="MyButton"
                  style="margin-left: 10px"> Мед Карта
          </button>
        </td>
      </tr>
      </tbody>
    </table>

    </div>

    <div *ngIf="!isTableLoaded">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>

    <mat-paginator [pageSizeOptions]="[2, 3, 4, 5, 6, 7, 8, 9, 10]" [pageSize]="3" [length]="totalElements"
                   (page)="nextPage($event)" showFirstLastButtons="true">

    </mat-paginator>

  </div>

<!--  <div *ngIf = "appointments == null && isLoaded">-->
  <div *ngIf = "isEmpty">

    <mat-card class="text-center">
      <mat-card-header><h1>Ooops...</h1></mat-card-header>
      <mat-card-body>
        <mat-card-title>
          <h3>Похоже, что у вас еще не было пациентов!</h3>
        </mat-card-title>
        <mat-card-text>Чтобы начать новый прием перейдите на страницу </mat-card-text>
        <a href="/create-appointment" mdbBtn color="primary">начать новый прием</a>
      </mat-card-body>
    </mat-card>

  </div>

</div>
